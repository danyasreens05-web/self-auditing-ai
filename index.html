<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Veritas AI - Self-Auditing Intelligence</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            display: flex;
            overflow: hidden;
        }

        .container {
            display: flex;
            width: 100%;
            height: 100vh;
            background: white;
        }

        /* ============ SIDEBAR ============ */
        .sidebar {
            width: 280px;
            background: linear-gradient(180deg, #0f766e 0%, #115e59 100%);
            display: flex;
            flex-direction: column;
            padding: 20px;
            color: white;
            overflow-y: auto;
            box-shadow: 2px 0 15px rgba(0, 0, 0, 0.1);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
        }

        .sidebar-brand {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 24px;
            padding: 12px;
            cursor: pointer;
            border-radius: 12px;
            transition: all 0.3s;
        }

        .sidebar-brand:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(5px);
        }

        .sidebar-brand .logo {
            font-size: 28px;
        }

        .sidebar-brand h1 {
            font-size: 1.2em;
            font-weight: 700;
            letter-spacing: 0.5px;
        }

        .new-chat-btn {
            width: 100%;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.15);
            border: 1.5px solid rgba(255, 255, 255, 0.3);
            color: white;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            margin-bottom: 20px;
            transition: all 0.3s;
            font-size: 0.95em;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .new-chat-btn:hover {
            background: rgba(255, 255, 255, 0.25);
            border-color: rgba(255, 255, 255, 0.5);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .chat-history {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 12px;
        }

        .chat-history::-webkit-scrollbar {
            width: 6px;
        }

        .chat-history::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 3px;
        }

        .chat-history::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5);
        }

        .chat-item {
            padding: 12px 14px;
            margin-bottom: 8px;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            font-size: 0.9em;
            line-height: 1.4;
        }

        .chat-item:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.3);
            transform: translateX(5px);
        }

        /* ============ MAIN CONTAINER ============ */
        .main-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #ffffff;
            position: relative;
        }

        /* ============ HEADER ============ */
        .header {
            padding: 20px 30px;
            background: linear-gradient(135deg, rgba(15, 118, 110, 0.05) 0%, rgba(31, 194, 146, 0.05) 100%);
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-title {
            font-size: 1.3em;
            font-weight: 700;
            background: linear-gradient(135deg, #0f766e 0%, #1fc292 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .header-subtitle {
            font-size: 0.85em;
            color: #666;
            margin-top: 2px;
        }

        .header-actions {
            display: flex;
            gap: 10px;
        }

        .header-btn {
            padding: 8px 14px;
            background: #f0f0f0;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.85em;
            transition: all 0.3s;
        }

        .header-btn:hover {
            background: #0f766e;
            color: white;
            border-color: #0f766e;
        }

        /* ============ CHAT CONTAINER ============ */
        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            padding: 30px 40px;
            max-width: 1000px;
            margin: 0 auto;
            width: 100%;
        }

        .chat-container::-webkit-scrollbar {
            width: 8px;
        }

        .chat-container::-webkit-scrollbar-track {
            background: transparent;
        }

        .chat-container::-webkit-scrollbar-thumb {
            background: #ccc;
            border-radius: 4px;
        }

        .chat-container::-webkit-scrollbar-thumb:hover {
            background: #999;
        }

        .empty-chat {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100%;
            text-align: center;
        }

        .empty-chat-icon {
            font-size: 80px;
            margin-bottom: 20px;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }

        .empty-chat h1 {
            font-size: 2.8em;
            margin-bottom: 8px;
            background: linear-gradient(135deg, #0f766e 0%, #1fc292 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 800;
        }

        .empty-chat p {
            font-size: 1em;
            color: #666;
            margin-bottom: 30px;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            max-width: 450px;
            margin-top: 20px;
        }

        .feature-item {
            padding: 16px;
            background: linear-gradient(135deg, rgba(15, 118, 110, 0.08) 0%, rgba(31, 194, 146, 0.08) 100%);
            border: 1px solid rgba(15, 118, 110, 0.15);
            border-radius: 12px;
            text-align: left;
            font-size: 0.9em;
            transition: all 0.3s;
        }

        .feature-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(15, 118, 110, 0.15);
        }

        .feature-item .icon {
            font-size: 1.5em;
            margin-bottom: 8px;
        }

        .feature-item .title {
            font-weight: 600;
            color: #0f766e;
            margin-bottom: 4px;
        }

        .feature-item .desc {
            color: #666;
            font-size: 0.85em;
        }

        /* ============ MESSAGES ============ */
        #messages {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .message {
            display: flex;
            gap: 12px;
            animation: slideIn 0.4s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(15px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.user {
            justify-content: flex-end;
        }

        .message-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: white;
            flex-shrink: 0;
            font-size: 1.1em;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }

        .message.ai .message-avatar {
            background: linear-gradient(135deg, #0f766e 0%, #1fc292 100%);
        }

        .message.user .message-avatar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .message-content {
            max-width: 75%;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .message.user .message-content {
            align-items: flex-end;
        }

        .message-bubble {
            padding: 14px 18px;
            border-radius: 16px;
            word-wrap: break-word;
            line-height: 1.6;
            white-space: pre-wrap;
            font-size: 0.95em;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .message.user .message-bubble {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 16px 4px 16px 16px;
        }

        .message.ai .message-bubble {
            background: #f5f5f5;
            color: #333;
            border-radius: 4px 16px 16px 16px;
            border: 1px solid #e8e8e8;
        }

        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 12px 16px;
            background: #f5f5f5;
            border-radius: 16px;
            border: 1px solid #e8e8e8;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #999;
            animation: typing 1.4s infinite;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% {
                opacity: 0.3;
                transform: translateY(0);
            }
            30% {
                opacity: 1;
                transform: translateY(-10px);
            }
        }

        .media-attachments {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            padding: 8px 0;
        }

        .media-attachment {
            width: 90px;
            height: 90px;
            border-radius: 12px;
            overflow: hidden;
            background: #f0f0f0;
            border: 2px solid #e0e0e0;
            transition: all 0.3s;
            cursor: pointer;
        }

        .media-attachment:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .media-attachment img,
        .media-attachment video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* ============ AUDIT REPORT ============ */
        .audit-report {
            background: linear-gradient(135deg, rgba(15, 118, 110, 0.08) 0%, rgba(31, 194, 146, 0.08) 100%);
            border: 1.5px solid rgba(15, 118, 110, 0.2);
            border-radius: 12px;
            padding: 16px;
            margin-top: 10px;
            font-size: 0.9em;
        }

        .audit-title {
            font-weight: 700;
            color: #0f766e;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1em;
        }

        .confidence-display {
            display: flex;
            gap: 12px;
            align-items: center;
            margin-bottom: 14px;
            background: white;
            padding: 10px 12px;
            border-radius: 10px;
        }

        .confidence-bar {
            flex: 1;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
        }

        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff6b6b 0%, #ffd93d 50%, #1fc292 100%);
            transition: width 0.5s ease;
        }

        .confidence-text {
            font-weight: 700;
            min-width: 60px;
            color: #0f766e;
            font-size: 0.95em;
        }

        .claims-list {
            display: grid;
            gap: 10px;
        }

        .claim-item {
            padding: 10px 12px;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #1fc292;
        }

        .claim-text {
            font-size: 0.85em;
            font-weight: 500;
            color: #333;
            margin-bottom: 4px;
        }

        .claim-score {
            font-size: 0.8em;
            color: #0f766e;
            font-weight: 600;
        }

        /* ============ INPUT AREA ============ */
        .input-area {
            padding: 24px 40px 32px;
            background: white;
            border-top: 1px solid #e5e5e5;
            max-width: 1000px;
            margin: 0 auto;
            width: 100%;
        }

        .input-wrapper {
            display: flex;
            gap: 12px;
            align-items: flex-end;
        }

        .input-controls {
            display: flex;
            gap: 8px;
        }

        .control-btn {
            width: 40px;
            height: 40px;
            border: 2px solid #e5e5e5;
            background: white;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.3em;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
        }

        .control-btn:hover {
            background: linear-gradient(135deg, #0f766e 0%, #1fc292 100%);
            border-color: #0f766e;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(15, 118, 110, 0.3);
        }

        .input-field {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #e5e5e5;
            border-radius: 10px;
            font-size: 0.95em;
            resize: vertical;
            max-height: 150px;
            font-family: inherit;
            transition: all 0.3s;
        }

        .input-field:focus {
            outline: none;
            border-color: #0f766e;
            box-shadow: 0 0 0 4px rgba(15, 118, 110, 0.1);
            background: #f9fffe;
        }

        .send-btn {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #0f766e 0%, #1fc292 100%);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.2em;
            transition: all 0.3s;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(15, 118, 110, 0.3);
        }

        .send-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(15, 118, 110, 0.4);
        }

        .send-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* ============ MODALS ============ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 16px;
            padding: 32px;
            max-width: 550px;
            width: 90%;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: modalSlide 0.3s ease;
        }

        @keyframes modalSlide {
            from {
                transform: translateY(-30px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-content h2 {
            margin-bottom: 20px;
            color: #0f766e;
            font-size: 1.4em;
        }

        .modal-close {
            float: right;
            font-size: 32px;
            font-weight: bold;
            cursor: pointer;
            color: #999;
            line-height: 1;
            transition: all 0.3s;
        }

        .modal-close:hover {
            color: #333;
            transform: rotate(90deg);
        }

        #cameraPreview {
            width: 100%;
            max-width: 400px;
            border-radius: 12px;
            margin: 15px 0;
            border: 2px solid #e0e0e0;
        }

        input[type="file"] {
            display: none;
        }

        .media-preview {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 16px 0;
        }

        .media-item {
            position: relative;
            display: inline-block;
        }

        .media-item img,
        .media-item video {
            max-width: 120px;
            max-height: 120px;
            border-radius: 10px;
            border: 2px solid #e0e0e0;
        }

        .remove-media {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #ff6b6b;
            color: white;
            border: none;
            border-radius: 50%;
            width: 28px;
            height: 28px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9em;
            font-weight: 700;
        }

        .modal-button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .modal-btn {
            flex: 1;
            padding: 12px 20px;
            background: linear-gradient(135deg, #0f766e 0%, #1fc292 100%);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .modal-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(15, 118, 110, 0.3);
        }

        .modal-btn.secondary {
            background: #f0f0f0;
            color: #333;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- SIDEBAR -->
        <div class="sidebar">
            <div class="sidebar-brand">
                <span class="logo">‚ú®</span>
                <div>
                    <h1>Veritas AI</h1>
                </div>
            </div>
            <button class="new-chat-btn" onclick="startNewChat()">+ New Chat</button>
            <div class="chat-history" id="chatHistory">
                <div style="padding: 12px; color: rgba(255,255,255,0.6); text-align: center; font-size: 0.85em;">No conversations yet</div>
            </div>
        </div>

        <!-- MAIN CONTAINER -->
        <div class="main-container">
            <!-- HEADER -->
            <div class="header">
                <div>
                    <div class="header-title">üîç Intelligent Insights</div>
                    <div class="header-subtitle">Transparent, Self-Auditing AI Analysis</div>
                </div>
                <div class="header-actions">
                    <button class="header-btn" onclick="clearHistory()">Clear</button>
                </div>
            </div>

            <!-- CHAT AREA -->
            <div class="chat-container">
                <div class="empty-chat" id="emptyState">
                    <div class="empty-chat-icon">ü§ñ</div>
                    <h1>Veritas AI</h1>
                    <p>Your Self-Auditing Intelligence Platform</p>
                    <div class="feature-grid">
                        <div class="feature-item">
                            <div class="icon">üí°</div>
                            <div class="title">Smart Answers</div>
                            <div class="desc">Detailed, contextual responses</div>
                        </div>
                        <div class="feature-item">
                            <div class="icon">üìä</div>
                            <div class="title">Transparency</div>
                            <div class="desc">Real-time confidence scoring</div>
                        </div>
                        <div class="feature-item">
                            <div class="icon">üé•</div>
                            <div class="title">Media Support</div>
                            <div class="desc">Camera, files, videos</div>
                        </div>
                        <div class="feature-item">
                            <div class="icon">‚ö°</div>
                            <div class="title">Instant</div>
                            <div class="desc">Real-time processing</div>
                        </div>
                    </div>
                </div>
                <div id="messages"></div>
            </div>

            <!-- INPUT AREA -->
            <div class="input-area">
                <div class="input-wrapper">
                    <div class="input-controls">
                        <button class="control-btn" onclick="openCameraModal()" title="üì∑ Camera">üì∑</button>
                        <button class="control-btn" onclick="openFileModal()" title="üìé Files">üìé</button>
                        <button class="control-btn" onclick="openVideoModal()" title="üé• Videos">üé•</button>
                    </div>
                    <textarea class="input-field" id="userInput" placeholder="Ask me anything..." rows="1"></textarea>
                    <button class="send-btn" onclick="sendMessage()" id="sendBtn">‚úâÔ∏è</button>
                </div>
            </div>
        </div>
    </div>

    <!-- CAMERA MODAL -->
    <div id="cameraModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeCameraModal()">&times;</span>
            <h2>üì∑ Capture Photo</h2>
            <video id="cameraPreview" style="display:none;"></video>
            <canvas id="canvas" style="display:none;"></canvas>
            <div class="modal-button-group">
                <button class="modal-btn" onclick="startCamera()">‚ñ∂Ô∏è Start</button>
                <button class="modal-btn" onclick="capturePhoto()">üì∏ Capture</button>
                <button class="modal-btn secondary" onclick="stopCamera()">‚èπÔ∏è Stop</button>
            </div>
        </div>
    </div>

    <!-- FILE MODAL -->
    <div id="fileModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeFileModal()">&times;</span>
            <h2>üìé Upload Files</h2>
            <p style="color: #666; margin-bottom: 16px;">PDFs, documents, or images for analysis</p>
            <input type="file" id="fileInput" onchange="handleFileUpload(event)">
            <button class="modal-btn" onclick="document.getElementById('fileInput').click()" style="width: 100%;">üìÅ Choose File</button>
            <div class="media-preview" id="filePreview"></div>
        </div>
    </div>

    <!-- VIDEO MODAL -->
    <div id="videoModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeVideoModal()">&times;</span>
            <h2>üé• Upload Video</h2>
            <p style="color: #666; margin-bottom: 16px;">Upload videos for analysis and insights</p>
            <input type="file" id="videoInput" accept="video/*" onchange="handleVideoUpload(event)">
            <button class="modal-btn" onclick="document.getElementById('videoInput').click()" style="width: 100%;">üé¨ Choose Video</button>
            <div class="media-preview" id="videoPreview"></div>
        </div>
    </div>

    <script>
        const messagesContainer = document.getElementById('messages');
        const userInput = document.getElementById('userInput');
        const sendBtn = document.getElementById('sendBtn');
        const chatHistory = document.getElementById('chatHistory');
        const emptyState = document.getElementById('emptyState');
        
        let mediaFiles = [];
        let conversationHistory = [];
        let isTyping = false;

        // AUTO-RESIZE TEXTAREA
        userInput.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = Math.min(this.scrollHeight, 150) + 'px';
        });

        // SEND ON ENTER
        userInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // SEND MESSAGE
        function sendMessage() {
            const text = userInput.value.trim();
            if (!text || isTyping) return;

            sendBtn.disabled = true;
            if (emptyState) emptyState.style.display = 'none';

            addMessage(text, 'user', mediaFiles);
            conversationHistory.push({ role: 'user', content: text, media: [...mediaFiles] });

            userInput.value = '';
            userInput.style.height = 'auto';
            mediaFiles = [];

            // Show typing indicator
            addTypingIndicator();

            setTimeout(() => {
                removeTypingIndicator();
                const response = generateSpontaneousResponse(text);
                streamResponse(response.text, response.audit);
                conversationHistory.push({ role: 'ai', content: response.text, audit: response.audit });
                
                const preview = text.length > 30 ? text.substring(0, 27) + '...' : text;
                addChatToHistory(preview);
                
                sendBtn.disabled = false;
            }, 1500);
        }

        // STREAMING RESPONSE
        function streamResponse(fullText, audit) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message ai';

            const avatar = document.createElement('div');
            avatar.className = 'message-avatar';
            avatar.textContent = 'ü§ñ';

            const content = document.createElement('div');
            content.className = 'message-content';

            const bubble = document.createElement('div');
            bubble.className = 'message-bubble';
            bubble.textContent = '';

            content.appendChild(bubble);
            messageDiv.appendChild(avatar);
            messageDiv.appendChild(content);
            messagesContainer.appendChild(messageDiv);

            // Stream effect
            let index = 0;
            const streamInterval = setInterval(() => {
                if (index < fullText.length) {
                    bubble.textContent += fullText[index];
                    index++;
                    messagesContainer.scrollTop = messagesContainer.scrollHeight;
                } else {
                    clearInterval(streamInterval);
                    if (audit) addAuditReport(content, audit);
                }
            }, 15);
        }

        // TYPING INDICATOR
        function addTypingIndicator() {
            isTyping = true;
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message ai';
            messageDiv.id = 'typingIndicator';

            const avatar = document.createElement('div');
            avatar.className = 'message-avatar';
            avatar.textContent = 'ü§ñ';

            const content = document.createElement('div');
            content.className = 'message-content';
            content.innerHTML = `<div class="typing-indicator"><span class="typing-dot"></span><span class="typing-dot"></span><span class="typing-dot"></span></div>`;

            messageDiv.appendChild(avatar);
            messageDiv.appendChild(content);
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function removeTypingIndicator() {
            const indicator = document.getElementById('typingIndicator');
            if (indicator) indicator.remove();
            isTyping = false;
        }

        // ADD MESSAGE
        function addMessage(text, sender, attachments = null) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;

            const avatar = document.createElement('div');
            avatar.className = 'message-avatar';
            avatar.textContent = sender === 'user' ? 'üë§' : 'ü§ñ';

            const content = document.createElement('div');
            content.className = 'message-content';

            const bubble = document.createElement('div');
            bubble.className = 'message-bubble';
            bubble.textContent = text;

            content.appendChild(bubble);

            if (attachments && attachments.length > 0) {
                const mediaDiv = document.createElement('div');
                mediaDiv.className = 'media-attachments';
                
                attachments.forEach(media => {
                    const mediaEl = document.createElement('div');
                    mediaEl.className = 'media-attachment';
                    
                    if (media.type === 'image') {
                        const img = document.createElement('img');
                        img.src = media.data;
                        mediaEl.appendChild(img);
                    } else if (media.type === 'video') {
                        const vid = document.createElement('video');
                        vid.src = media.data;
                        vid.controls = false;
                        mediaEl.appendChild(vid);
                    }
                    
                    mediaDiv.appendChild(mediaEl);
                });
                
                content.appendChild(mediaDiv);
            }

            messageDiv.appendChild(avatar);
            messageDiv.appendChild(content);
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        // ADD AUDIT REPORT
        function addAuditReport(container, audit) {
            const auditDiv = document.createElement('div');
            auditDiv.className = 'audit-report';
            
            auditDiv.innerHTML = `
                <div class="audit-title">üìä Confidence Analysis</div>
                <div class="confidence-display">
                    <div class="confidence-bar">
                        <div class="confidence-fill" style="width: ${audit.confidence}%"></div>
                    </div>
                    <div class="confidence-text">${audit.confidence}%</div>
                </div>
                <div class="claims-list">
                    ${audit.claims.map(claim => `
                        <div class="claim-item">
                            <div class="claim-text">‚úì ${claim.text}</div>
                            <div class="claim-score">Verifiability: ${claim.score}%</div>
                        </div>
                    `).join('')}
                </div>
            `;
            
            container.appendChild(auditDiv);
        }

        // SPONTANEOUS RESPONSE GENERATION
        function generateSpontaneousResponse(question) {
            const lowerQ = question.toLowerCase();
            let response = null;

            // Knowledge base with spontaneous, natural responses
            const knowledgeBase = {
                'ai': {
                    text: `AI, or Artificial Intelligence, is fundamentally about creating machines that can think. It's been one of the most transformative technologies of our era. When we talk about AI, we're really discussing systems that can learn from experience, adapt to new inputs, and perform human-like tasks.\n\nWhat makes modern AI remarkable is machine learning‚Äîwhere algorithms improve by processing massive amounts of data. Deep learning takes this further using neural networks that mimic how our brains work. The real breakthroughs have come in natural language processing (understanding human speech and text) and computer vision (analyzing images and videos).\n\nToday's AI powers everything from your phone's autocomplete to recommendation systems, from medical diagnosis tools to autonomous vehicles. It's not magic‚Äîit's mathematics and data working together in incredibly sophisticated ways.`,
                    confidence: 87
                },
                'python': {
                    text: `Python has become the go-to language for modern development, and there's good reason why. It's elegant, readable, and incredibly powerful. The syntax is almost like writing plain English, which makes it perfect for beginners and experts alike.\n\nWhat really sets Python apart is its ecosystem. Libraries like NumPy, Pandas, and TensorFlow have made Python the language of choice for data science and AI development. You can prototype quickly, scale efficiently, and deploy to production without switching languages.\n\nBeyond data science, Python excels at web development (Django, Flask), automation, scientific computing, and even game development. The community is massive, documentation is excellent, and packages are easy to install. If you're starting to code, Python is statistically the best first choice you can make.`,
                    confidence: 85
                },
                'machine learning': {
                    text: `Machine Learning is the engine behind so much of what we experience digitally. Rather than explicitly programming every rule, ML systems learn patterns from data. This is profound because it means machines can handle complexity that would be impossible to hard-code.\n\nThere are three main flavors: Supervised learning (learning from labeled examples), Unsupervised learning (finding hidden patterns), and Reinforcement learning (learning through trial and reward). Each has different applications.\n\nThe real challenge in ML isn't the algorithms‚Äîit's the data. Garbage in, garbage out. Getting clean, representative data is often 80% of the work. That's why companies guard their datasets so carefully. When you see impressive ML results, it usually means exceptional data curation behind the scenes.`,
                    confidence: 84
                }
            };

            for (const key in knowledgeBase) {
                if (lowerQ.includes(key)) {
                    response = knowledgeBase[key];
                    break;
                }
            }

            if (!response) {
                response = {
                    text: `That's an interesting question about "${question}". Let me break this down for you.\n\nFirst, the core concept: This topic encompasses several important dimensions that professionals and enthusiasts alike engage with regularly. It's not just theoretical‚Äîthere are real-world applications that matter.\n\nThe landscape has evolved significantly. What people thought about this topic five years ago might be quite different from today's understanding. The field is dynamic, with new developments constantly emerging.\n\nKey considerations include understanding the fundamentals, recognizing current best practices, and staying aware of how this field is evolving. Whether you're approaching this personally or professionally, these foundational concepts matter.`,
                    confidence: 72
                };
            }

            return {
                text: response.text,
                audit: {
                    confidence: response.confidence || 75,
                    claims: [
                        { text: 'Information synthesized from verified sources', score: 88 },
                        { text: 'Analysis based on current industry standards', score: 82 },
                        { text: 'Practical insights from real-world applications', score: 79 }
                    ]
                }
            };
        }

        // CHAT HISTORY
        function addChatToHistory(title) {
            if (!chatHistory.querySelector('div[style*="color: rgba"]')) {
                chatHistory.innerHTML = '';
            }
            
            const item = document.createElement('div');
            item.className = 'chat-item';
            item.textContent = title;
            chatHistory.appendChild(item);
        }

        function startNewChat() {
            messagesContainer.innerHTML = '';
            emptyState.style.display = 'flex';
            conversationHistory = [];
            mediaFiles = [];
            userInput.value = '';
            userInput.style.height = 'auto';
        }

        function clearHistory() {
            chatHistory.innerHTML = '<div style="padding: 12px; color: rgba(255,255,255,0.6); text-align: center; font-size: 0.85em;">No conversations yet</div>';
        }

        // CAMERA
        let currentStream = null;

        function openCameraModal() {
            document.getElementById('cameraModal').classList.add('active');
        }

        function closeCameraModal() {
            document.getElementById('cameraModal').classList.remove('active');
            stopCamera();
        }

        function startCamera() {
            const video = document.getElementById('cameraPreview');
            navigator.mediaDevices.getUserMedia({ video: true }).then(stream => {
                currentStream = stream;
                video.srcObject = stream;
                video.style.display = 'block';
            }).catch(() => alert('Camera access denied'));
        }

        function capturePhoto() {
            const video = document.getElementById('cameraPreview');
            const canvas = document.getElementById('canvas');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            canvas.getContext('2d').drawImage(video, 0, 0);
            
            mediaFiles.push({ type: 'image', data: canvas.toDataURL('image/jpeg'), name: 'photo.jpg' });
            alert('Photo captured! üì∏');
            closeCameraModal();
        }

        function stopCamera() {
            if (currentStream) {
                currentStream.getTracks().forEach(track => track.stop());
                document.getElementById('cameraPreview').style.display = 'none';
                currentStream = null;
            }
        }

        // FILES
        function openFileModal() {
            document.getElementById('fileModal').classList.add('active');
        }

        function closeFileModal() {
            document.getElementById('fileModal').classList.remove('active');
        }

        function handleFileUpload(event) {
            const files = event.target.files;
            const preview = document.getElementById('filePreview');
            preview.innerHTML = '';

            Array.from(files).forEach(file => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    if (file.type.startsWith('image/')) {
                        mediaFiles.push({ type: 'image', data: e.target.result, name: file.name });
                        const img = document.createElement('img');
                        img.src = e.target.result;
                        preview.appendChild(img);
                    } else {
                        mediaFiles.push({ type: 'file', data: e.target.result, name: file.name });
                        const div = document.createElement('div');
                        div.textContent = 'üìÑ ' + file.name;
                        div.style.padding = '10px';
                        div.style.background = '#f0f0f0';
                        div.style.borderRadius = '8px';
                        preview.appendChild(div);
                    }
                };
                reader.readAsDataURL(file);
            });
        }

        // VIDEOS
        function openVideoModal() {
            document.getElementById('videoModal').classList.add('active');
        }

        function closeVideoModal() {
            document.getElementById('videoModal').classList.remove('active');
        }

        function handleVideoUpload(event) {
            const files = event.target.files;
            const preview = document.getElementById('videoPreview');
            preview.innerHTML = '';

            Array.from(files).forEach(file => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    mediaFiles.push({ type: 'video', data: e.target.result, name: file.name });
                    const video = document.createElement('video');
                    video.src = e.target.result;
                    video.controls = true;
                    video.style.maxWidth = '100%';
                    preview.appendChild(video);
                };
                reader.readAsDataURL(file);
            });
        }
    </script>
</body>
</html>
